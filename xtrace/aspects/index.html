<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Brownsys Tracing Framework Documentation</title>

        <link rel="stylesheet" href="http://brownsys.github.io/tracing-framework/css/bootstrap.min.css">
        <link rel="stylesheet" href="http://brownsys.github.io/tracing-framework/css/font-awesome.min.css">
        <link rel="stylesheet" href="http://brownsys.github.io/tracing-framework/css/highlight.dark.css">
        <link rel="stylesheet" href="http://brownsys.github.io/tracing-framework/css/main.css">
            <link href="http://fonts.googleapis.com/css?family=Abel:400|Oswald:300,400,700" media="all" rel="stylesheet" type="text/css">
    </head>
    <body>

        <header class="navbar navbar-default navbar-fixed-top">

            <a class="navbar-brand" href="http://brownsys.github.io/tracing-framework/">
                Brownsys Tracing Framework Documentation
                            </a>

                            <a href="https://github.com/brownsys/tracing-framework">
                    <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
                </a>
            
        </header>

        <main class="container-fluid">
            <div class="row">

                
                    <nav id="sidebar" class="col-sm-4 col-lg-3" role="navigation">

                 <!--       <ul class="nav nav-pills nav-stacked">
                                                    </ul> -->

                        <ul>
                                                            <li>
                            		                                        <a class="sectionlink" href="http://brownsys.github.io/tracing-framework/">                        
                                                                        Overview
                                                                            </a>
                                    
                                    <ul>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/projects/tracingplane.html">
                                                    TracingPlane
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/projects/xtrace.html">
                                                    X-Trace
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/projects/retro.html">
                                                    Retro
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/projects/pivottracing.html">
                                                    Pivot Tracing
                                                </a>
                                            </li>
                                                                            </ul>
                                </li>
                                                            <li>
                            		                                        <a class="sectionlink" href="http://brownsys.github.io/tracing-framework/">                        
                                                                        Tutorials
                                                                            </a>
                                    
                                    <ul>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/tutorials/gettingstarted.html">
                                                    Getting Started
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/tutorials/xtrace.html">
                                                    Using X-Trace
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/tutorials/retro.html">
                                                    Using Retro
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/tutorials/pivottracing.html">
                                                    Using PivotTracing
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/tutorials/baggage.html">
                                                    Adding Baggage To Your System
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/tutorials/aspects.html">
                                                    Using Automatic Instrumentation
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/tutorials/tracingapplication.html">
                                                    Using Baggage Yourself
                                                </a>
                                            </li>
                                                                            </ul>
                                </li>
                                                            <li>
                            		                                        <a class="sectionlink" href="http://brownsys.github.io/tracing-framework/tracingplane">                        
                                                                        Tracing Plane
                                                                            </a>
                                    
                                    <ul>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/tracingplane/pubsub">
                                                    PubSub
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/tracingplane/client">
                                                    Baggage
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/tracingplane/aspects">
                                                    Auto-Baggage
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/tracingplane/dynamic">
                                                    Dynamic Instrumentation
                                                </a>
                                            </li>
                                                                            </ul>
                                </li>
                                                            <li>
                            		                                        <a class="sectionlink" href="http://brownsys.github.io/tracing-framework/xtrace">                        
                                                                        X-Trace
                                                                            </a>
                                    
                                    <ul>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/xtrace/client">
                                                    Client Library
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/xtrace/aspects">
                                                    Automatic Instrumentation
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/xtrace/server">
                                                    Report Server
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/xtrace/visualization">
                                                    Visualization
                                                </a>
                                            </li>
                                                                            </ul>
                                </li>
                                                            <li>
                            		                                    Retro
                                    
                                    <ul>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/retro/resources">
                                                    Resource Instrumentation
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/retro/aspects">
                                                    Auto-Instrumentation
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/retro/aggregation">
                                                    Aggregation
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/retro/throttling">
                                                    Tenant Throttling
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/retro/visualization">
                                                    Visualization
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/retro/configuration.html">
                                                    Configuration
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/retro/retrowithxtrace.html">
                                                    Retro + X-Trace
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/retro/lockinstrumentation.html">
                                                    Instrumentation for Locks
                                                </a>
                                            </li>
                                                                            </ul>
                                </li>
                                                            <li>
                            		                                    Pivot Tracing
                                    
                                    <ul>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/pivottracing/client">
                                                    Client Library
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/pivottracing/agent">
                                                    Pivot Tracing Agent
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/pivottracing/privileged">
                                                    Privileged Classes
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/pivottracing/test">
                                                    Examples
                                                </a>
                                            </li>
                                                                            </ul>
                                </li>
                                                            <li>
                            		                                    Reference
                                    
                                    <ul>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/config.html">
                                                    Configuration
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/tools.html">
                                                    Tools and Executables
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/test.html">
                                                    Test Page
                                                </a>
                                            </li>
                                                                            </ul>
                                </li>
                                                    </ul>


                    </nav>

                

                <section id="content" class="col-sm-8 col-lg-9">
                    <h2 id="x-trace---automatic-instrumentation-tools">X-Trace - Automatic Instrumentation Tools</h2>
<p>This project provides some AspectJ aspects that enhance X-Trace in the following ways:</p>
<h3 id="report-decoration">Report Decoration</h3>
<p>Calls to <code>XTraceLogger.log()</code> will be overridden to additionally pass the AspectJ <code>thisJoinPointStaticPart</code> object.  This enables X-Trace to add additional information to reports such as the source file and line number.</p>
<h3 id="baggage-api-logging">Baggage API Logging</h3>
<p>Calls to the static Baggage API will be wrapped so that X-Trace logging calls are also generated.  This is useful for observing the boundaries of execution and, combined with report decoration, where in the source code this is happening.</p>
<p>All reports are generated using the <code>edu.brown.cs.systems.xtrace.logging.BaggageWrappers</code> logging agent, which can be disabled as with any other agent.</p>
<p>The following shows an example of some of the reports generated:</p>
<p><img src="../../docs/images/baggage_log.png" alt="Generated X-Trace report" title="X-Trace report generated by instrumenting Baggage api calls" />
<img src="../../docs/images/baggage_log_2.png" alt="Generated X-Trace report" title="X-Trace report generated by instrumenting Baggage api calls" /></p>
<h3 id="commons-and-log4j-logging">Commons and log4j Logging</h3>
<p>X-Trace can proxy all calls to log4j/commons loggers and generate X-Trace reports at the same time.  For example, the following code, when instrumented, will also produce an X-Trace report:</p>
<p><img src="../../docs/images/log4j_code_a.png" alt="Source code" title="Some Hadoop source code" /></p>
<p><img src="../../docs/images/log4j_code_b.png" alt="Source code" title="Some Hadoop source code" /></p>
<p><img src="../../docs/images/log4j_log.png" alt="Generated X-Trace report" title="X-Trace report generated by overriding the log4j message" /></p>
<p>X-Trace will override calls to <code>org.apache.commons.logging.LogFactory.getLog()</code> and <code>org.slf4j.LoggerFactory.getLogger()</code> and wrap the returned loggers in custom wrapped classes.  The wrapped classes proxy all calls to the original underlying logger.  In addition, they generate X-Trace reports using the provided logging class.
The wrapped loggers that X-Trace returns have slightly modified logic for their <code>isEnabled()</code> methods.  Now, a logger is enabled if the underlying log4j/commons logger is enabled, OR if the underlying X-Trace logger is valid (eg, it has a task ID and the logging class is enabled).</p>
<p>The config value <code>xtrace.client.reporting.default_level</code> can be set to <code>debug</code>, <code>info</code>, <code>trace</code>, <code>warn</code>, <code>error</code>, or <code>fatal</code>, to tell X-Trace the minimum logging level for generating X-Trace reports from proxied log4j/commons logging calls.  Furthermore, this value can be overridden on a per-task basis.  The static call <code>XTrace.setLoggingLevel()</code> can set the desired logging level <em>for an individual request</em>.</p>
<p>The following example starts an X-Trace task, and sets its logging level to debug:</p>
<pre><code>XTrace.startTask(true);
XTrace.setLoggingLevel(XTraceLoggingLevel.DEBUG);</code></pre>
<p>The request will generate X-Trace reports for all debug-level logging statements and greater -- very verbose.</p>
<h3 id="main-method-tracing">Main method tracing</h3>
<p>X-Trace will instrument all main methods to start an X-Trace task.  Set <code>xtrace.client.tracemain</code> to false to disable this behavior.  Set <code>xtrace.client.tracemain_level</code> to the desired logging level for the log4j/commons logging messages.  The specific code that is added to main method is as follows:</p>
<pre><code>if (XTraceSettings.traceMainMethods()) {
    XTrace.startTask(true);
    XTrace.setLoggingLevel(XTraceSettings.mainMethodLoggingLevel());
    XTrace.getLogger(XTraceInit.class).tag(thisJoinPointStaticPart, "Process main method begin", Utils.getMainClass().getSimpleName(), "main");
}</code></pre>
<h3 id="configuration">Configuration</h3>
<p>X-Trace Automatic Instrumentation Tools support the following default config values:</p>
<pre><code>xtrace {
    client {
        reporting {
            default_level       = "warn"    # log4j / apache commons loggers will proxy 'warn' messages or higher to xtrace
        }
        tracemain       = true  # If enabled, the XTraceInit aspect will start an X-Trace task from any main methods
        tracemain_level = "warn" # If enabled, the XTraceInit aspect will set the log4j / apache commons logging level to 'warn' or higher 
    }
}</code></pre>
                </section>

            </div>
        </main>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="//yastatic.net/highlightjs/8.2/highlight.min.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                // Syntax highlighting
                hljs.initHighlightingOnLoad();
            });
        </script>

    </body>
</html>
