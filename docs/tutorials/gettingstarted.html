<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Brown Tracing Framework</title>

        <link rel="stylesheet" href="http://brownsys.github.io/tracing-framework/css/bootstrap.min.css">
        <link rel="stylesheet" href="http://brownsys.github.io/tracing-framework/css/font-awesome.min.css">
        <!-- <link rel="stylesheet" href="http://brownsys.github.io/tracing-framework/css/highlight.dark.css"> -->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/googlecode.min.css">

        <link rel="stylesheet" href="http://brownsys.github.io/tracing-framework/css/main.css">
        <link href="http://fonts.googleapis.com/css?family=Abel:400|Oswald:300,400,700" media="all" rel="stylesheet" type="text/css">
    </head>
    <body>

        <header class="navbar navbar-default navbar-fixed-top">

            <div class="navbar-title col-lg-10 col-lg-offset-1">
                <a class="navbar-logo" href="http://brownsys.github.io/tracing-framework/">
                                            <img src="http://brownsys.github.io/tracing-framework/docs/images/baggage.png"></img>
                                    </a>

                <a class="navbar-brand" href="http://brownsys.github.io/tracing-framework/">
                    Brown Tracing Framework
                                    </a>
            </div>

                            <a href="https://github.com/brownsys/tracing-framework">
                    <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
                </a>
            
        </header>

        <main class="container-fluid">
            <div class="row">

                
                    <nav id="sidebar" class="col-sm-4 col-lg-3 col-lg-offset-1" role="navigation">

                 <!--       <ul class="nav nav-pills nav-stacked">
                                                    </ul> -->

                        <ul>
                                                            <li>
                            		                                        <a class="sectionlink" href="http://brownsys.github.io/tracing-framework/">                        
                                                                        Home
                                                                            </a>
                                    
                                    <ul>
                                                                            </ul>
                                </li>
                                                            <li>
                            		                                        <a class="sectionlink" href="http://brownsys.github.io/tracing-framework/docs/tutorials.html">                        
                                                                        Tutorials
                                                                            </a>
                                    
                                    <ul>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/tutorials/prerequisites.html">
                                                    Pre-requisites
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/tutorials/gettingstarted.html">
                                                    Getting Started: HDFS
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/tutorials/pivottracing.html">
                                                    Getting Started: Pivot Tracing
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/tutorials/baggage.html">
                                                    Adding Baggage To Your System
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/tutorials/tracingapplication.html">
                                                    Using Baggage Yourself
                                                </a>
                                            </li>
                                                                            </ul>
                                </li>
                                                            <li>
                            		                                        <a class="sectionlink" href="http://brownsys.github.io/tracing-framework/tracingplane">                        
                                                                        Tracing Plane
                                                                            </a>
                                    
                                    <ul>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/tracingplane/pubsub">
                                                    PubSub
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/tracingplane/client">
                                                    Baggage
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/tracingplane/aspects">
                                                    Auto-Baggage
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/tracingplane/dynamic">
                                                    Dynamic Instrumentation
                                                </a>
                                            </li>
                                                                            </ul>
                                </li>
                                                            <li>
                            		                                        <a class="sectionlink" href="http://brownsys.github.io/tracing-framework/pivottracing">                        
                                                                        Pivot Tracing
                                                                            </a>
                                    
                                    <ul>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/pivottracing/client">
                                                    Client
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/pivottracing/tracepoints.html">
                                                    Client: Tracepoints
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/pivottracing/queries.html">
                                                    Client: Writing Queries
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/pivottracing/installing.html">
                                                    Client: Installing Queries
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/pivottracing/agent">
                                                    Agent
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/pivottracing/privileged">
                                                    Agent: Privileged Classes
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/pivottracing/test">
                                                    Examples
                                                </a>
                                            </li>
                                                                            </ul>
                                </li>
                                                            <li>
                            		                                        <a class="sectionlink" href="http://brownsys.github.io/tracing-framework/xtrace">                        
                                                                        X-Trace
                                                                            </a>
                                    
                                    <ul>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/xtrace/client">
                                                    Client Library
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/xtrace/aspects">
                                                    Automatic Instrumentation
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/xtrace/server">
                                                    Report Server
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/xtrace/visualization">
                                                    Visualization
                                                </a>
                                            </li>
                                                                            </ul>
                                </li>
                                                            <li>
                            		                                    Retro
                                    
                                    <ul>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/retro/resources">
                                                    Resource Instrumentation
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/retro/aspects">
                                                    Auto-Instrumentation
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/retro/aggregation">
                                                    Aggregation
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/retro/throttling">
                                                    Tenant Throttling
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/retro/visualization">
                                                    Visualization
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/retro/configuration.html">
                                                    Configuration
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/retro/retrowithxtrace.html">
                                                    Retro + X-Trace
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/retro/lockinstrumentation.html">
                                                    Instrumentation for Locks
                                                </a>
                                            </li>
                                                                            </ul>
                                </li>
                                                            <li>
                            		                                    Reference
                                    
                                    <ul>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/config.html">
                                                    Configuration
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/tools.html">
                                                    Tools and Executables
                                                </a>
                                            </li>
                                                                                    <li class="">
                                                <a class="pagelink" href="http://brownsys.github.io/tracing-framework/docs/pom.html">
                                                    Example pom.xml
                                                </a>
                                            </li>
                                                                            </ul>
                                </li>
                                                    </ul>


                    </nav>

                

                <section id="content" class="col-sm-8 col-lg-6">
                    <h1 id="getting-started-hdfs">Getting Started: HDFS</h1>
<p>This section describes how to get started with a pre-instrumented version of HDFS that has all of the instrumentation libraries added to it.  We will run a version of Hadoop 2.7.2 instrumented with Baggage, and run an example X-Trace, Retro, and Pivot Tracing application.</p>
<p>Clone the <a href="https://github.com/brownsys/tracing-framework">git repository</a></p>
<pre><code>git clone git@github.com:brownsys/tracing-framework.git</code></pre>
<p>From the directory you cloned into, build and install with the following command:</p>
<pre><code>mvn clean package install -DskipTests</code></pre>
<p>Next, download our <a href="https://github.com/brownsys/hadoop">pre-instrumented fork of Hadoop 2.7.2</a></p>
<pre><code>git clone git@github.com:brownsys/hadoop.git</code></pre>
<p>We want to use branch <code>brownsys-pivottracing-2.7.2</code>, which should be the default branch.</p>
<p>Build and install Hadoop using the following command:</p>
<pre><code>mvn clean package install -Pdist -DskipTests -Dmaven.javadoc.skip="true"</code></pre>
<p>If you encounter any problems while building, try building the non-instrumented branch <code>branch-2.7.2</code>.  This will determine whether it is a Hadoop build issue, or a problem with our extra instrumentation.</p>
<h3 id="configuring-hdfs">Configuring HDFS</h3>
<p>The following instructions will configure a minimally working version of HDFS.  From the base directory for the Hadoop git repository, the built version of hadoop will be located in <code>hadoop-dist/target/hadoop-2.7.2</code>.  Within the build directory, <code>etc/hadoop</code> will contain the default config.  Copy this directory to somewhere outside of the HDFS build directory, otherwise any changes you make will be overwritten any time you build HDFS.  Edit <code>core-site.xml</code> to the following:</p>
<pre><code>&lt;configuration&gt;
  &lt;property&gt;
    &lt;name&gt;fs.default.name&lt;/name&gt;
    &lt;value&gt;hdfs://127.0.0.1:9000&lt;/value&gt;
  &lt;/property&gt;
&lt;/configuration&gt;</code></pre>
<p>Set the following two environment variables:</p>
<ul>
<li><code>HADOOP_HOME</code> to the build directory, eg. <code>hadoop-dist/target/hadoop-2.7.2</code></li>
<li><code>HADOOP_CONF_DIR</code> to the location of your copied HDFS config.</li>
</ul>
<h3 id="running-pubsub">Running PubSub</h3>
<p>All of the instrumentation libraries use a pub sub system to communicate.  Agents running in the instrumented Hadoop will receive commands over pubsub, and send their output back over the pubsub.  The pubsub project is in <code>tracingplane/pubsub</code></p>
<p>The following command will start an X-Trace server which also includes a pub sub server:</p>
<pre><code>tracingplane/pubsub/target/appassembler/bin/server</code></pre>
<p>To check which Java process are running, use the <code>jps</code> command.  This is an easy way to check if something has crashed.  You should expect to see a process called <code>StandaloneServer</code>.</p>
<h3 id="start-hdfs">Start HDFS</h3>
<p>From the base directory for the Hadoop git repository, the built version of hadoop will be located in <code>hadoop-dist/target/hadoop-2.7.2</code>.  Within the build directory, <code>bin</code> contains various command line utilities, while <code>sbin</code> contains some useful scripts for starting and stopping processes.  Before starting HDFS, we must format its data dir:</p>
<pre><code>${HADOOP_HOME}/bin/hdfs --config $HADOOP_CONF_DIR namenode -format</code></pre>
<p>Then start an HDFS NameNode and HDFS DataNode:</p>
<pre><code>${HADOOP_HOME}/sbin/hadoop-daemon.sh start namenode
${HADOOP_HOME}/sbin/hadoop-daemon.sh start datanode</code></pre>
<p>You should expect to see messages in the output stream along the lines of the following:</p>
<pre><code>Pivot Tracing initialized
Resource reporting executor started
ZmqReporter: QUEUE-disk -&gt; queue
ZmqReporter: DISK- -&gt; disk
ZmqReporter: CPU- -&gt; cpu
/META-INF/lib/libthreadcputimer.dylib extracted to temporary file /var/folders/d3/38f0syys5yjcvynz8p4n3t4w0000gn/T/jni_file_2410736199844535966.dll</code></pre>
<p>Again, check which Java processes are running using the <code>jps</code> command.  In addition to <code>XTraceServer</code>, you should expect to see <code>NameNode</code> and <code>DataNode</code>
For reference, HDFS runs a Web UI by default at <a href="http://localhost:50070">localhost:50070</a>.</p>
<h3 id="optional-start-hdfs-with-multiple-datanodes">Optional: Start HDFS with multiple DataNodes</h3>
<p>A more interesting HDFS setup will have you running one NameNode process and multiple DataNode processes.  This can be done on the same machine, however, you must specify configurations for each datanode you start (otherwise they might try to use the same data directory, for example).  The following script will start multiple datanodes.  Change the <code>NUM_DATANODES</code> and <code>BASE_DATA_DIR</code> variables as appropriate.</p>
<pre><code>NUM_DATANODES=3;
BASE_DATA_DIR=/Users/jon/deploy

echo "===== Starting HDFS with $NUM_DATANODES datanodes =====";
${HADOOP_HOME}/sbin/hadoop-daemon.sh start namenode;

for i in $(seq $NUM_DATANODES) 
do
  export HADOOP_LOG_DIR=$BASE_DATA_DIR/logs/datanode_$i
  export HADOOP_PID_DIR=$BASE_DATA_DIR/pid/datanode_$i
  export HADOOP_OPTS="\
    -Dhadoop.tmp.dir=$BASE_DATA_DIR/data/datanode_$i \
    -Ddfs.datanode.address=0.0.0.0:5001$i \
    -Ddfs.datanode.http.address=0.0.0.0:5008$i \
    -Ddfs.datanode.ipc.address=0.0.0.0:5002$i"
  ${HADOOP_HOME}/sbin/hadoop-daemon.sh --script bin/hdfs start datanode $HADOOP_OPTS
done</code></pre>
                </section>

            </div>
        </main>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <!-- <script src="//yastatic.net/highlightjs/8.2/highlight.min.js"></script> -->
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>


        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                // Syntax highlighting
                hljs.initHighlightingOnLoad();
            });
        </script>

    </body>
</html>
